{% extends "admin/admin.base.html.twig" %}

{% block title %}Éditeur d'Élement de Révision{% endblock %}

{% block main_class %}items-center p-4 pt-[88px] justify-center{% endblock %}

{% block main %}
    <div class="container px-4 py-8">
        <div class="rounded-xl bg-foreground-500 mx-auto">
            <div class="p-8">
                {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

                <div>
                    {{ form_label(form.sortNumber) }}
                    {{ form_widget(form.sortNumber, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.sortNumber) }}
                </div>

                <div>
                    {{ form_label(form.style) }}
                    {{ form_widget(form.style, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.style) }}
                </div>

                <div>
                    {{ form_label(form.first) }}
                    {{ form_widget(form.first, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.first) }}
                </div>

                <div>
                    {{ form_label(form.separatorText) }}
                    {{ form_widget(form.separatorText, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.separatorText) }}
                </div>

                <div id="revision-element-preview" class="p-4 bg-foreground-400 rounded">
                </div>

                <div>
                    {{ form_label(form.second) }}
                    {{ form_widget(form.second, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.second) }}
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        const preview = document.getElementById('revision-element-preview');
                        const styleInput = document.getElementById("{{ form.style.vars.id }}");
                        const firstInput = document.getElementById("{{ form.first.children.content.vars.id }}");
                        const secondInput = document.getElementById("{{ form.second.children.content.vars.id }}");
                        const separatorInput = document.getElementById("{{ form.separatorText.vars.id }}");

                        function update() {
                            preview.innerHTML = `
                                <div class="flex ${parseInt(styleInput.value, 10) === 0 ? "md:flex-row flex-col" : "flex-col"}">
                                    <div class="shrink-0">
                                        <span class="whitespace-pre text-wrap!">${ firstInput.value } ${ separatorInput.value } </span>
                                    </div>
                                    <div class="flex-1 min-w-1/2">
                                        <span class="whitespace-pre text-wrap!">${ secondInput.value }</span>
                                    </div>
                                </div>`;

                            renderLatex(preview);
                        }

                        update();
                        [styleInput, firstInput, secondInput, separatorInput].forEach((item) => {
                            item.addEventListener('input', update);
                        })
                    })
                </script>

                <div>
                    {{ form_label(form.details) }}
                    {{ form_widget(form.details, {'attr': {'class': 'w-full'}}) }}
                    {{ form_errors(form.details) }}
                </div>

                <div>
                    <twig:ListInput title="question" field="{{ form.questions }}" :une="true"/>
                </div>

                <button type="submit">Enregistrer</button>
                {{ form_end(form) }}
            </div>
            <div class="px-8 py-2 bg-foreground-300/50 border-t rounded-b-xl border-foreground-300 text-center flex flex-col">

            </div>
        </div>
    </div>
{% endblock %}
